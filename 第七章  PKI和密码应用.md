# 第七章  PKI和密码学应用 

本章涵盖的CISSP认证考试主题包括：
* 域3：安全架构和工程
	* 3.9 应用密码学
		* 3.9.1 密码生命周期(例如：密钥管理、算法挑选)
		* 3.9.2 加密方法
		* 3.9.3 公钥基础设施(KPI)
		* 3.9.4 密钥管理实践规范
		* 3.9.5 数字签名
		* 3.9.6 不可否认性
		* 3.9.7 完整性
		* 3.9.8 了解密码分析攻击的方法
		* 3.9.9 数字版权管理(DRM)
		
## 7.1 非对称密码
* 私钥(对称)密码系统要求通信双方使用同一个秘密秘钥，从而产生了安全秘钥分发的问题。
* 公钥(非对称)密码学使用公钥和私钥对，免去了复杂密钥分发系统的负担。
* 三种公钥密码系统:RSA, El Gamal和椭圆曲线密码(ECC)。

### 7.1.1 公钥与私钥
* 发送者:P->(加密算法：接收者的公钥)->C
* 接收者:C->(解密算法：接收者的私钥)->P
* DSA密钥长度：1024位。

### 7.1.2 RSA（兼具加密和数字签名）
* 1977年提出并取得专利(20年保护，2000年把公开算法)。RSA算法依赖因式分解大素数的天然计算难度。密钥长度：1024位。

### 7.1.3 EI Gamal
* 1985年提出。
* Diffie-Hellman：用来在不安全的链路和物理手段交换秘钥。
* EI Gamal优点： 没有申请专利，公开发布，使用免费（扩展了Diffie-Hellman秘钥交换协议，支持消息的加解密）。
* 缺点：算法加密的任何消息的长度都加倍。

### 7.1.4 椭圆曲线密码系统(ECC)
* 1985年提出。
* 1088位的RSA秘钥相当于160位的椭圆曲线密码系统的秘钥强度。密钥长度：160位。

## 7.2 散列函数
* 散列函数的用途： 产生消息摘要
* 发送者出于两个原因将消息摘要与整条消息发送给接收者：1：接收者比对，2：消息摘要可用来执行数字签名算法。
* 消息摘要128位或更长，一个个位值用来执行奇偶校验功能。
* 散列函数的基本要求：
	1. 输入值可以是任意长度
	2. 输出值具有固定长度
	3. 散列函数在计算任何输入值要相对容易
	4. 散列函数是单向的
	5. 散列函数是不会发生冲突的
* 4中常见散列算法：安全散列算法(SHA), 消息摘要2(MD2), 消息摘要4(MD4), 消息摘要5(MD5), 散列消息鉴别码(HMAC)。
* 可变长度散列(HAVAL)是MD5的修订版，使用1024块，产生128, 160, 192, 224和256位散列值。

### 7.2.1 SHA(安全散列算法)
* SHA-1生成160位消息摘要。处理512位块的消息。不安全，
* SHA-2理论上是安全的，4个变体：SHA-256：用512位块生成256位消息摘要。
	1. SHA-256：用512位块大小生成256位消息摘要。
	2. SHA-224：用512位块大小生成224位消息摘要。
	3. SHA-512：用1024位块大小生成512位消息摘要。
	4. SHA-384：用1024位块大小生成384位消息摘要。
* SHA-3：将Keccak算法定义为SHA-3标准，通过更安全的算法取代SHA-2散列算法。

### 7.2.2 MD2
* 1989年开发，生成128位消息摘要。不是单向函数，已不再使用。

### 7.2.3 MD4
* 1990年强化MD2而来，通过3轮计算处理512位消息块，输出128位消息摘要。MD4存在消息摘要冲突，不是安全的散列算法

### 7.2.4 MD5
* 处理512位的消息块，通过4轮计算生成128位消息摘要。非常容易出现冲突。

* 散列算法记忆表
![](https://i.imgur.com/PCZ7KYu.jpg)

## 7.3 数字签名
* 数字签名的目的：
	* 可以向接收方保证、消息确实来自自己申明的发送者，且实施了不可否认性
	* 向接收方保证：消息在传输过程中没有改动，可以防御恶意篡改合无意改动。
* 消息签名本身不提供隐私保护，只满足加密目标中的完整性和不可否认性
* 发送者:P->(加密算法：发送者的私钥(散列算法(SHA3-512(P))))->P + 消息摘要(数字签名)1
* 接收者:P + 消息摘要(数字签名)1->(加密算法：发送者的公钥(散列算法(SHA3-512(P)))) === (加密算法：发送者的公钥(消息摘要(数字签名)1)
* 数字签名只确保实现完整性、鉴别和不可否认性。如果要确保隐私不外泄，需要在将金国签名的消息摘要负载明文消息尾之后，用接收者的公钥加密整条消息，接收者受到消息后，先用自己的私钥解密消息。

### 7.3.1 HMAC 基于散列的消息鉴别码
* 实现了部分数字签名功能，保证了消息传输过程的完整性、但不提供不可否认性
* HMAC依赖一个共享的秘钥，所以不提供不可否认性

### 7.3.2 数字签名标准
* NIST规定数字签名算法必须使用SHA-3散列函数，
* 数字签名算法（DSA）
* RSA算法（既能数字签名又能加密！）
* 椭圆曲线数字签名算法(ECDSA)

## 7.4 公钥基础设施(PKI)
* 公钥加密主要优点是原本不认识的双方之间的通信变得很容易，受信任的公钥基础设施层次使这一点称为可能

### 7.4.1 证书
* 数字证书为通信双方提供了保证，与他们通信的确实是他们申称的人。数字证书是一个人的公钥的签注副本。

### 7.4.2 发证机构
* 发证机构(CA)将公钥基础设施绑定在一起，这些中性机构提供数字证书提供公证服务。
* 注册机构(RA)分担了CA签发数字证书前验证用户身份的负担。

### 7.4.3 证书的生成与销毁
1. 注册
	* 采取某种方式向证书授权机构证明身份的过程被称为注册
2. 验证
	* 通过CA的公钥检查CA的数字签名来验证证书，接着检查证书没在CRL（证书撤销列表）
3. 撤销
	* 证书撤销原因：证书失信、证书误发、证书的细节发生变化、安全关联变更。
	* 证书撤销的技术：
	* 证书撤销列表(CRL)：缺点是必须定期下载CRL并交叉参照，证书的撤销和通知用户撤销之间存在时间延迟。
	* 联机证书状态协议(OCSP):解决认证撤销列表的固有的时间延迟。

### 7.5 非对称秘钥管理
* 选择加密系统：它配备的算法已经在公共领域公开，经历了业界专家的百般挑剔。
* 选择秘钥：确保密钥确实是随机生成的。
* 使用公钥加密时，一定要保证私钥严格保密。
* 秘钥强制轮换要求，需要每隔几个月更管一次密钥对。
* 秘钥备份或使用密钥托管服务。
* 硬件安全模块(HSM)提供管理加密密钥的有效方法：以某种安全的方式储存和管理加密密钥，包括USB装置或云供应商(IaaS服务)。

## 7.6 应用密码学

### 7.6.1 便携式设备
* 目前主流操作系统都包括磁盘加密功能，可信平台模块。

### 7.6.2 电子邮件
1. 电子邮件规则
	* 邮件需要机密性则加密邮件
	* 邮件需要完整性，进行一次散列运算
	* 邮件需要鉴别、完整性和/或不可否认性，进行数字签名
	* 邮件需要保密性、完整性、鉴别和不可否认性，对邮件加密和数字化签名
* 永远由发送者承担责任。	
2. 电子邮件标准
	* 良好隐私(PGP):商业版用RSA进行密钥交换、IDEA加解密，使用MD5生成消息摘要；免费版使用Diff-Hellman秘钥交换，CAST128位的加密/解密算法以及SHA-1散列函数生成消息摘要。
	* S/MIME(安全多用途互联网邮件扩展协议)：加密电子邮件的标准。通过X.509证书交换密码秘钥，支持AES、3DES对称加密算法。

### 7.6.3 Web应用程序
* 安全陶杰字层(SSL), 传输层安全(TLS)。
* SSL协议，SSL的目标是建立安全的通信信道，步骤：
	* 用户访问一个网站时，浏览器检索Web服务器的证书并从中提取服务器公钥；
	* 浏览器随后创建一个随即堆成密钥，用服务器的公钥对密钥加密，然后将加密后的堆成密钥发送给服务器。
	* 服务器随后用自己的私钥解密堆成密钥，两个系统这是通过堆成加密密钥交换所有未来消息。
* POODLE攻击（贵宾犬攻击）的攻击表明在TLS的SSL 3.0反馈机制中存在重大缺陷，很多机构放弃对SSL的支持，依靠TLS的安全性。

* 隐写术和水印
	* 隐写术：通过加密技术把秘密消息嵌入另一条消息的技术。如嵌入到图像文件或WAV文件。
	* 水印：给文件加上数字水印以保护知识产权。

### 7.6.4 数字版权管理(DRM)
* 音乐、电影：(高宽带数字内容保护(HDCP), 高级访问内容系统(AACS))、电子书(ADEPT)、视频游戏:、文档(ADEPT)

### 7.6.5 联网
1. 链路加密
	* 链路加密使用软件或硬件解决在两个点之间建立一条安全隧道，在隧道的一段加密进入的所有通信流，在另一端解密流出的所有通信流。
	* 端到端加密有终于保护通信双方之间的通信安全，独立于链路加密。
	* 链路加密和端到端的加密区别：链路加密中，所有的数据都会被加密，下一条重新解密然后加密，降低了路由速度，端到端的加密不加密报头、尾、地址和路由数据，容易被嗅探和偷听者攻击
	* SSH是一个端到端的加密
2. IPSec（Internet密钥交换（IKE）解决了在不安全的网络环境（如Internet）中安全地建立或更新共享密钥的问题。）
	* IPSec通过公钥密码学提供加密、访问控制、不可否认性以及消息身份认证，并且一般使用IP协议
	* IPSec组件：
		* 身份验证头(AH),提供完整性和不可否认性的保证、提供身份认证和访问控制，并可以防止重放攻击
		* 安全封装有效载荷(ESP) 提供数据包内容的机密性和完整性，提供有限的身份认证，防止重放攻击
	* IPSec两种操作模式：
		* 运输模式：只有数据包有效载荷被加密，为对等通信设计
		* 隧道模式：整个数据包都会被加密，为网关间通信设计
3. ISAKMP（网络安全关联秘钥管理协议）
	* 通过协商、建立、修改和删除安全关联为IPSec提供后台的安全支持服务
	* ISAKMP基本要求：
		* 对通信对等进行身份关联
		* 建立并管理安全关联
		* 提供秘钥生成机制
		* 防止遭受威胁
4. 无线互联
* 有限等价隐私（WEP）
	* WiFi安全访问：通过TKIP（临时秘钥完整协议）消除危害WEP的密码学弱点（客户端到无线接入点）

## 7.7 密码学攻击
* 分析攻击：试图降低算法复杂性的代数运算，关注算法本身的逻辑
* 实现攻击：利用密码学系统的实现中的弱点，涉及错误与权限，编写加密系统程序所使用的方法
* 统计攻击：试图发现驻留密码学应用程序的硬件或操作系统中的漏洞
* 蛮力攻击：尝试有可能的、有效的秘钥或密码组合，彩虹表和转为蛮力涉及和开发的专业化、可扩展的硬件
* 频率分析和仅知密文攻击：拥有加密后的密文信息，即仅知密文攻击；频率分析就是一种已证明可行的对抗简单密码的技术
* 已知明文攻击：攻击者具有已加密消息的副本以及用以产生密文的明文消息
* 选定密文攻击：攻击者能够解密所选的部分密文信息，并且可以使用已解密的部分消息来发现秘钥
* 选定明文攻击：攻击者能够加密所选的明文信息，可以分析加密算法输出的密文
* 中间相遇攻击：针对使用两轮加密的算法
* 中间人攻击：怀有恶意的人置身于通信双方之间的位置并截获所有的通信
* 生日攻击：冲突攻击或逆向散列匹配，寻找散列函数一一对应特性中的缺陷，基于两个不同的消息使用相同的散列函数产生共同的消息摘要的概率
* 重放攻击：拦截通信双方的加密消息，重放捕捉的信息以打开新的会话
