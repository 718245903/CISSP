# 第六章  密码学与对称密钥算法

本章涵盖的CISSP认证考试主题包括：
* 域2：资产安全
	* 2.5 确定数据安全控制
		* 2.5.1 了解数据状态
* 域3：安全架构和工程
	* 3.5 评价和抑制安全架构、设计和解决方案元素的漏洞
		* 3.5.4 密码系统
	* 3.9 应用密码学
		* 3.9.1 密码生命周期(如密钥管理、密钥挑选)
		* 3.9.2 加密方法(如对称、非对称、椭圆曲线)
		* 3.9.3 不可否认性
		* 3.9.4 完整性(如散列)
		
## 6.1 密码学的历史里程碑

### 6.1.1 凯撒密码
简单的将字母表中的每个字母替换成其后的三个字母，是单一字母的替代置换密码，面对“频率分析”攻击时，非常脆弱。

### 6.1.2 美国南北战争
采用复杂的文字替换和移位组合。

### 6.1.3 Ultra与Enigma
二战前期德国商用代码机Enigma。这台机器采用一些列3到6位轮转执行一种极其复杂的替换密码。
为攻击Enigma，盟军绝密行动，代号Ultra。在1940年成功破解Enigma代码。

### 6.2 密码学基本知识

### 6.2.1 密码学的目标
密码系统基本目标： 保密性、完整性、身份验证和不可否认性。

1. 保密性
	* 保密性：确保数据在静止、传输和使用等三种不同状态下始终保持私密。两大类型密码系统实现保密性：
	* 对称秘钥密码：使用一个共享秘密密钥，提供给密码系统的所有用户。
	* 公钥密码系统: 为系统每个用户单独组合的公钥和私钥。
	* 三种不同类型的数据：
		* 静止数据：或被存储数据，是指驻留在一个永久位置上等待访问的数据。
		* 运动中的数据：或线路上的数据，指正在两个系统之间通过网络传送的数据。运动中的数据可能通过公司网络、无线网络或公共互联网传送。
		* 使用中的数据：指保存在计算机系统的内存中，可供系统上运行的流程访问的数据。
2. 完整性
	* 完整性：确保数据没有被人为授权更改。
	* 完整性通过使用加密的消息摘要实现，即“数字签名”。
3. 身份验证
	* 身份认证：用于验证系统用户所声称的身份，是密码系统的一项主要功能。挑战-应答身份协议是身份验证的一种方案。
4. 不可否认性
	* 不可否认性向接收者保证：消息发自发送者，而且没有冒充发送者。
	* 秘密秘钥（对称秘钥）密码系统不提供不可否认性。
	* 公钥(非对称秘钥)密码系统提供不可否认性。

### 6.2.2密码学概念
* 消息发送者使用密码学算法将明文消息加密为密文消息，使用字母C表示。
* 创建和实现秘密代码和密码的技术被称为密码术。
* 密码术和密码分析学被成为密码学。
* 一种代码或密码在硬件和软件中具体执行叫密码系统。

### 6.2.3 密码数学
* 二进制数学：“开”状态叫做真值，把“关”状态叫做假指。
* 逻辑运算: 
	1. AND(与)(^):只有在X和Y都为真的列中，输出为真。即：1^1=1，其余为0(假)。
	2. OR(或)(V):只有两个值都为假时，返回假值。
	3. NOT(非)(~或!):颠倒一个输入变量的指。只有一个变量运算。
	4. Exclusive OR(异或)(XOR)(⊕):当一个输入值为真时，XOR函数才返回一个真值。如果两个值都为假或两个值都为真，则XOR函数的输出为假。
* 模函数(mod)(%):它是一次除法运算之后留下的余数。eg: 8 mod 6 = 2
* 单向函数:是便于为输入的每种可能组合生成输出值的一种数学运算。
* Nonce:密码常通过给加密过程添加随机性来获得强度，Nonce是一个随机数，充当占位符变量。
* 零知识证明:你确实知道一个事实，但同时不能把这个事实本身披露给该第三方。通常通过口令和其他秘密鉴别符实现。
* 分割知识:当执行某项操作所要求的信息或权限被分散到多名用户手中时，任何一个人都不会具有足够的权限来破解环境的安全，这种把职责分类和双人控制于一个解决方案的做法叫“分割知识”。密码托管概念是体现分割知识的最佳例子。N分之M控制要求操办人总数(N)中至少要有M个操办人同时在场才能执行高安全级任务(其中M永远要小于或等于N)。
* 代价函数:对一个加密系统实施一次完整蛮力攻击所需付出的时间和精力，通常是代价函数所代表的内容。

### 6.2.4 密码
* 代码与密码：
	* 代码：是由代表单词和短语的符号构成的密码系统。
	* 密码：始终隐藏消息的真实含义。
* 移位密码：使用某种加密算法重新排列明文消息中的字母，形成密文消息，解密算法只需要逆向执行加密转换便可恢复原始消息。
* 替代密码：通过加密算法用一个不同的字符替换铭文消息的每个字符或位,如凯撒密码。eg:C = (P + 3) mod 26; P = (C - 3) mod 26; Vigenere密码系统：使用一个加密/解密图，加密流程：

A B C D E F G H I J K L M N O P Q R S T U V W X Y Z  
————————————————————————————————————————————————————  
A B C D E F G H I J K L M N O P Q R S T U V W X Y Z  
B C D E F G H I J K L M N O P Q R S T U V W X Y Z A  
C D E F G H I J K L M N O P Q R S T U V W X Y Z A B  
D E F G H I J K L M N O P Q R S T U V W X Y Z A B C  
E F G H I J K L M N O P Q R S T U V W X Y Z A B C D  
F G H I J K L M N O P Q R S T U V W X Y Z A B C D E  
G H I J K L M N O P Q R S T U V W X Y Z A B C D E F  
H I J K L M N O P Q R S T U V W X Y Z A B C D E F G  
I J K L M N O P Q R S T U V W X Y Z A B C D E F G H  
J K L M N O P Q R S T U V W X Y Z A B C D E F G H I  
K L M N O P Q R S T U V W X Y Z A B C D E F G H I J  
L M N O P Q R S T U V W X Y Z A B C D E F G H I J K  
M N O P Q R S T U V W X Y Z A B C D E F G H I J K L  
N O P Q R S T U V W X Y Z A B C D E F G H I J K L M  
O P Q R S T U V W X Y Z A B C D E F G H I J K L M N  
P Q R S T U V W X Y Z A B C D E F G H I J K L M N O  
Q R S T U V W X Y Z A B C D E F G H I J K L M N O P  
R S T U V W X Y Z A B C D E F G H I J K L M N O P Q  
S T U V W X Y Z A B C D E F G H I J K L M N O P Q R  
T U V W X Y Z A B C D E F G H I J K L M N O P Q R S  
U V W X Y Z A B C D E F G H I J K L M N O P Q R S T  
V W X Y Z A B C D E F G H I J K L M N O P Q R S T U  
W X Y Z A B C D E F G H I J K L M N O P Q R S T U V  
X Y Z A B C D E F G H I J K L M N O P Q R S T U V W  
Y Z A B C D E F G H I J K L M N O P Q R S T U V W X  
Z A B C D E F G H I J K L M N O P Q R S T U V W X Y  

Vigenere密码系统：使用一个加密/解密图，加密流程：
	* 写出明文；
	* 在明文下面写出加密密钥，重复这个密钥指导于明文长度一样；
	* 定位第一个以明文字符开头的列，定位第一个以密钥字符开头的行，定位行与列交叉处为该字母密文。重复步骤。
* 单词密本(Vernam密码)：对明文消息的每个字母都使用一个不同的字母表，极为强大的替代密码，C = (P + k) mod 26；其中K是用于将明文字母P加密成密文字母C的加密密钥。一个不可破解的加密方案必须满足如下要求：
	1. 加密秘钥必须随机生成；
	2. 单次秘本必须处于物理保护之下。
	3. 每个单次秘本必须只使用一次
	4. 秘钥必须至少与被加密的消息一样长
	5. 一次性填充缺点：只可用于短消息、分发和保护需要冗长的秘钥。
* 运动密钥密码(书密码)：在这套密码中，加密密钥与消息本身一样长，而且往往选自一本普通书籍。C = (P + k) mod 26
* A赋值0，Z赋值25
————————————————————————————————————————————————————  
明文：    R  I  C  H  A  R  D  W  I  L  L  
密钥：		W  I  T  H  M  U  C  H  I  N  T  
数值明文：17 8  2  7  0  17 3  22	8  11 11  
数字密钥: 22 8	19 7	12 20 2	 7  8  13 19  
数字密文：13 16 21 14 12 11 5  3  16 24 4  
密文：    N	 Q  V  O  M  L  F  D  Q  Y  E  
————————————————————————————————————————————————————  

* 流密码：一次在消息(或消息流)的一个字符或一个位上运行，如凯撒密码
* 混淆和扩散：密码算法依靠两种基本运算来隐藏明文消息：
	* 混淆：攻击者不能通过改动明文和分析结果密文来确定秘钥。
	* 扩展：明文发生的一点变化，会导致多个变化在整个密文中传播。
* 替换带来的就是混淆，移位带来的就是扩散。

## 6.3 现代密码学

### 6.3.1 密码密钥
* 早期密码学“通过隐匿获得安全”，隐匿算法细节。现代密码系统并不依靠其算法的保密性。所依靠的时为一个或多个密码密钥保密。密钥的长度依然是极其重要的因素。密钥的长度与密码系统的代价函数直接相关：密钥越长，破解密码系统越难。

### 6.3.2 对称加密算法
* 对称秘钥依赖一个共享的加密秘钥，该秘钥会分发给所有参与通信的成员
* 对称秘钥也被成为秘密秘钥加密法和私钥加密法。
* 对称秘钥的弱点
	1. 秘钥分发是主要问题。对方在通过一个机密密钥协议建立通信之前，首先必须找到一种安全的方法交换秘密密钥。如果没有现成的安全电子通信可供使用，则采用安全的线下密钥分发方法（即外带交换）。
	2. 对称秘钥加密法不提供不可否认性
	3. 这种算法缺乏可伸缩性
	4. 秘钥必须经常重新生成
* 对称秘钥密码可扩展性问题：n个通信方之间完全连接需要的秘钥总数为：n*（n-1）/2

### 6.3.2 非对称秘钥算法
* 非对称秘钥算法也被成为公钥算法，每个用户都有公钥和私钥
* 非对称秘钥的优点：
	1. 新增用户只需要生成一对公钥-私钥对
	2. 便于从非对称系统删除用户
	3. 只有在用户的私钥失信时，才需要生成秘钥
	4. 非对称秘钥加密提供了完整性、身份认证和不可否认性
	5. 秘钥分发简便易行
	6. 不需要预先建立通信关联
* 对称和非对称密码学系统比较：

![](https://imgur.com/qLRHWmo.jpg)

### 6.3.4 散列算法
公钥密码系统与消息摘要配套可提供数字签名能力，消息摘要是由散列算法生成的消息内容归纳(与文件校验没什么不同)。一个散列函数为两种不同发发产生相同值的情况叫做冲突(碰撞)，而冲突的存在通常回导致散列算法贬值。
* 常用的散列算法：
	* 消息摘要2（MD2）
	* 消息摘要5（MD5）
	* 安全散列算法(SHA-0,SHA-1,SHA-2)
	* 基于散列的消息身份认证代码(HMAC)

## 6.4 对称密码
* 常见对称密码系统：DES（数据加密标准）、3DES（三重数据加密标准）、IDEA（国际数据加密算法）、Blowfish、Skipjack、AES（高级加密标准）

### 6.4.1 数据加密标准(DES) 
* DES是不安全的，通过常常的一系列异或(XOR)运算生成密文，这个过程会为每个加密/解密操作重复16遍，每次重复叫做一轮加密。是一个64位的块密码，56位密钥，具有五种操作模式：
	1. 电子代码本模式（ECB）：安全性最差，每次处理一个64位分组，如果多次遇到统一个块，会生成相同的加密快。ECB模块只有用来交换少量数据。最不安全。
	2. 密码链接模式（CBC）：每块未加密文本在通过DES算法加密前，先要借助前面生成的密文块接受异或(XOR)运算。初始向量(IV)。
		* 缺点：如果一个块在传输中毁坏，这个快以及气候的块将无法解密。
	3. 密码反馈模式（CFB）：流密码形式的CBC、针对实时生成的数据进行运算。使用与块大小相同的存储缓冲区。使用一个IV，此外使用了链接。
	4. 输出反馈模式（OFB）：与DES模式几乎相同。OFB优势在于不存在链接函数，传输错误不会传播，影响后面块的解密。
	5. 计数器模式（CTR）：流密码，利用一个简单的计数器为每次运算增量，与OFB模式一样，CTR模式不会传播错误。

### 6.4.2 三重数据加密算法(3DES)
* DES的改进版，是一个64位的块密码，3DES有四个版本：
	1. DES EEE3：使用3个不同的秘钥(k1,k2,k3)对明文加密三次，E(K1, E(k2, E(k3, p))),有效密钥长度168位。
	2. DES EDE3：使用3个不同的秘钥(k1,k2,k3)，但是用一次解密运算替换了第二次加密运算：E(k1, D(k2, E(k3, p)))
	3. DES EEE2：使用2个不同的秘钥(k1,k2),E(k1, E(k2, E(k1, p))),有效密钥长度112位。
	4. DES EDE2：使用2个不同的秘钥(k1,k2),E(k1, D(k2, E(k1, p))),有效密钥长度112位。
* 四个模式在安全性上水平相当。

### 6.4.3 国际数据加密算法（IDEA）
* 针对DES算法的秘钥长度不够开发的，采用128位的秘钥开始运算，这个密钥被分解成52个16位子密钥进行一系列运算，IDEA能在DES使用的5种模式(ECB, CBC, CFB, OFB和CTR)下运行。
* IDEA算法由瑞士开发者取得专利，专利与2012年到期。

### 6.4.4 Blowfish（SSH使用）
* Blowfish扩展了IDEA的秘钥长度，可使用变长秘钥最短32位，最长448位。BlowFish算法公共开放，比IDEA和DES更快。

### 6.4.5 Skipjack
* 对64位的文本分组操作，使用80位的秘钥。它支持加密密钥托管。两家政府国家标准与技术研究院(NIST)，财政部各持有重建Skipjack密钥所需信息的一部分。
* Skipjack和Clipper芯片并不受密码界欢迎，因为托管程序由美国政府控制。

### 6.4.6 高级加密协议(AES)
* 使用128(10轮加密)、192(12轮加密)、和256位(14轮加密)加密，支持128块处理对称加密算法记忆表
* Twofish算法:是一种块密码，在128位数据块上运行，最长达256位的密码密钥。利用了两种技术：预白化处理、白化后处理。

![](https://i.imgur.com/fKyUdh2.jpg[/img])

### 6.4.7 对称秘钥管理
密钥管理实践规范：包括秘密密钥创建、分发、存储、销毁、恢复和托管的防护手段。
1. 创建和分发对称密钥
	* 线下分发：一方向另一方提供包括秘钥的一张纸或一份存储介质。缺陷包括：如果密钥材料通过邮件发送可能会被人拦截，电话可能被人窃听，写有密钥的纸张可能被人无意扔进垃圾桶或丢。
	* 公钥加密：使用公钥加密建立初始的通信链接，连接成功创建且各方互相验证身份后，通过这个安全公钥连接交换秘密密钥。
	* Diffie-Hellman：在不安全的链路和物理手段可用来交换秘钥。
2. 存储和销毁对称秘钥
	* 遵循最佳实践规范存储加密密钥：
	* 绝不能将加密密钥与被加密数据保存在同一个系统里。
	* 敏感秘钥考虑两个人分别持有秘钥的一半片段。即分割知识原则。
	* 人员调动或离职时密钥必须更换。
3. 秘钥托管和恢复
	* 公平密码系统：私钥分成多分，交给独立的第三方
	* 托管加密标准：向政府提供解密密文的技术手段

### 6.4.8 密码生命周期
* 规定机构可接受的密码算法，例如：AES, 3DES, RSA.
* 根据被传输信息的敏感性识别可与每种算法配套使用的可接受密钥长度；
* 枚举可用的安全传输协议（SSL和TLS）

## 书面实验
1. 组织档次秘本系统被广泛用来保证数据保密性的主要障碍是什么？
主要障碍在于：创建和分发算法所以奶的极长密钥实在空难。

2. 用关键词SECURE通过以为加密消息"I will pass the CISSP exam and become certified next month"。
S E C U R E
5 2 1 6 4 3
接下来，在关键词字母下一次写出消息的字母：
S E C U R E
5 2 1 6 4 3
I W I L L P
A S S T H E
C I S S P E
X A M A N D
B E C O M E
C E R T I F
I E D N E X 
T M O N T H
最后，读取各列顺序从1开始，以每列往下读的方式给消息加密。
I S S M C R D O W S I A E E E M P E E D E F X H L H P N M I E T I A C X B C I T L T S A O T N N

3. 用凯撒ROT3 替换密码解密消息"F R Q J U D W X O D W L R Q V B R X J W L W".
congratulations you got it